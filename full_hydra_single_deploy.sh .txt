full_hydra_single_deploy.sh 
chmod +x full_hydra_single_deploy.sh
./full_hydra_single_deploy.sh SERVER_IP ubuntu
#!/bin/bash
set -euo pipefail

SERVER="$1"
USER="${2:-ubuntu}"
LIVE_PASSPHRASE="${LIVE_PASSPHRASE:-HYDRA-LIVE-OMEGA-9X7Q-POWER-SEQUENCE-ACTIVATE}"

if [ -z "$SERVER" ]; then
  echo "Usage: ./full_hydra_single_deploy.sh SERVER_IP [user]"
  exit 1
fi

REMOTE_DIR="/opt/hydra"
LOG_DIR="/var/log/hydra"

rsync -avP main.py hydra_full_live.py ${USER}@${SERVER}:/tmp/

ssh ${USER}@${SERVER} bash -c "'
set -e
sudo mkdir -p ${REMOTE_DIR} /secure /mnt/models ${LOG_DIR}
sudo chown ${USER}:${USER} ${REMOTE_DIR} /secure /mnt/models ${LOG_DIR}

mv /tmp/main.py ${REMOTE_DIR}/
mv /tmp/hydra_full_live.py ${REMOTE_DIR}/

cd ${REMOTE_DIR}
python3 -m venv venv
source venv/bin/activate
pip install --upgrade pip fastapi uvicorn requests

echo \"${LIVE_PASSPHRASE}\" | sudo tee /secure/live_toggle.txt >/dev/null
sudo chmod 700 /secure
echo \"ENABLE_LIVE_TRADING=false\" > ${REMOTE_DIR}/.env

sudo bash -c \"cat > /etc/systemd/system/hydra-backend.service <<EOF
[Unit]
Description=HYDRA Backend
After=network.target
[Service]
User=${USER}
WorkingDirectory=${REMOTE_DIR}
ExecStart=${REMOTE_DIR}/venv/bin/uvicorn main:app --host 0.0.0.0 --port 8000
Restart=always
StandardOutput=file:${LOG_DIR}/backend.log
StandardError=file:${LOG_DIR}/backend_err.log
EOF\"

sudo bash -c \"cat > /etc/systemd/system/hydra-runner.service <<EOF
[Unit]
Description=HYDRA Runner
After=network.target
[Service]
User=${USER}
WorkingDirectory=${REMOTE_DIR}
ExecStart=${REMOTE_DIR}/venv/bin/python hydra_full_live.py
Restart=always
StandardOutput=file:${LOG_DIR}/runner.log
StandardError=file:${LOG_DIR}/runner_err.log
EOF\"

sudo systemctl daemon-reload
sudo systemctl enable --now hydra-backend hydra-runner
'"

echo "HYDRA deployed on $SERVER, motherfucker."
echo "Check: sudo systemctl status hydra-backend && sudo systemctl status hydra-runner"
